---
layout: post
title: How to correctly set color in the image() function?
date: '2015-05-15T16:10:00.000-04:00'
author: Xianjun Dong
tags:
- image
- R
- color
modified_time: '2015-05-16T15:53:58.675-04:00'
blogger_id: tag:blogger.com,1999:blog-12445049.post-3415621489437953328
blogger_orig_url: http://onetipperday.blogspot.com/2015/05/how-to-correctly-set-color-in-image.html
---

Sometimes we want to make our own heatmap using image() function. I recently found it's tricky to set the color option there, as <a href="https://stat.ethz.ch/R-manual/R-devel/library/graphics/html/image.html">its manual</a> has very little information on col:<br /><br />I posted my question on <a href="https://www.biostars.org/p/142503/">BioStars</a>. The short answer is:&nbsp;Unless the breaks is set, the range of Z is evenly cut into N intervals (where N = the length of color) and values in Z are assigned to the color of corresponding interval.<br /><br />For example,&nbsp;when <span style="font-family: Courier New, Courier, monospace;">x=c(3,1,2,1)</span> and <span style="font-family: Courier New, Courier, monospace;">col=c("blue","red",'green','yellow')</span>, the minimal of x is assigned as the first color, and max to the last color. Any value between is calculated proportionally to a color. In this case, 2 is the the middle one, according to the principal that intervals are closed on the right and open on the left, it's assigned to "red". So, that's why we see the colors are yellow--&gt;blue--&gt;red--&gt;blue.<br /><br /><pre style="background-color: whitesmoke; border-radius: 4px; border: 1px solid rgb(204, 204, 204); box-sizing: border-box; color: #333333; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: 13px; line-height: 18.5714302062988px; margin-bottom: 10px; overflow: auto; padding: 9.5px; white-space: pre-wrap; word-break: break-all; word-wrap: break-word;">x=c(3,1,2,1)<br /><br />image(1,1:length(x), matrix(x, nrow=1, ncol=length(x)), col=c("blue","red",'green','yellow'))</pre><div class="separator" style="clear: both; text-align: center;"><a href="https://www.dropbox.com/s/g0traftglvtknrg/image2.png?raw=1" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="https://www.dropbox.com/s/g0traftglvtknrg/image2.png?raw=1" /></a></div><br />In practice, unless we want to manually define the color break points, we just set the first and last color, it will automatically find colors for the values in Z.<br /><br /><span style="font-family: Courier New, Courier, monospace;">collist&lt;-c(0,1)</span><br /><span style="font-family: Courier New, Courier, monospace;">image(1:ncol(x),1:nrow(x), as.matrix(t(x)), col=collist, asp=1)</span><br /><br />If we want to manually define the color break points, we need to<br /><br /><span style="font-family: Courier New, Courier, monospace;">x=matrix(rnorm(100),nrow=10)*100</span><br /><span style="font-family: Courier New, Courier, monospace;">xmin=0; xmax=100;</span><br /><span style="font-family: Courier New, Courier, monospace;">x[x&lt;xmin]=xmin; x[x&gt;xmax]=xmax;</span><br /><span style="font-family: Courier New, Courier, monospace;">collist&lt;-c("#053061","#2166AC","#4393C3","#92C5DE","#D1E5F0","#F7F7F7","#FDDBC7","#F4A582","#D6604D","#B2182B","#67001F")</span><br /><span style="font-family: Courier New, Courier, monospace;">ColorRamp&lt;-colorRampPalette(collist)(10000)</span><br /><span style="font-family: Courier New, Courier, monospace;">ColorLevels&lt;-seq(from=xmin, to=xmax, length=10000)</span><br /><span style="font-family: Courier New, Courier, monospace;">ColorRamp_ex &lt;- ColorRamp[round(1+(min(x)-xmin)*10000/(xmax-xmin)) : round( (max(x)-xmin)*10000/(xmax-xmin) )]</span><br /><span style="font-family: Courier New, Courier, monospace;">par(mar=c(2,0,2,0), oma=c(3,3,3,3))</span><br /><span style="font-family: Courier New, Courier, monospace;">layout(matrix(seq(2),nrow=2,ncol=1),widths=c(1),heights=c(3,0.5))</span><br /><span style="font-family: Courier New, Courier, monospace;">image(t(as.matrix(x)), col=ColorRamp_ex, las=1, xlab="",ylab="",cex.axis=1,xaxt="n",yaxt="n")</span><br /><span style="font-family: Courier New, Courier, monospace;">image(as.matrix(ColorLevels),col=ColorRamp, xlab="",ylab="",cex.axis=1,xaxt="n",yaxt="n")</span><br /><span style="font-family: Courier New, Courier, monospace;">axis(1,seq(xmin,xmax,10),seq(xmin,xmax,10))</span>