---
layout: post
title: how to quick sort a 20G bed file?
date: '2013-03-15T12:08:00.000-04:00'
author: Xianjun Dong
tags:
- sort
- linux
- sorting
- BED
- large file
- split
modified_time: '2013-08-27T23:27:15.881-04:00'
blogger_id: tag:blogger.com,1999:blog-12445049.post-4225864039468766485
blogger_orig_url: http://onetipperday.blogspot.com/2013/03/how-to-quick-sort-20g-bed-file.html
---

We are often suggested to&nbsp;sort the input bed file by "sort -k1,1 -k2,2n" in order to invokes a memory-efficient algorithm designed for large files, for example, bedtools intersect ( http://bedtools.readthedocs.org/en/latest/content/tools/intersect.html)<br /><br />But this is slow for a large file up to 20G in size.<br /><br />Here are some quicker solutions for that<br /><br /><span style="background-color: #3d85c6;">Solution #1:</span><br /><blockquote class="tr_bq"><span style="font-family: Courier New, Courier, monospace;">inputbed=$1<br />awk -v inputbed=$inputbed '{print $0 &gt;&gt; inputbed"."$1}'</span>&nbsp;</blockquote><blockquote class="tr_bq"><span style="font-family: Courier New, Courier, monospace;">#or, use "split -l 100000 $inputbed $inputbed." to split large file into small files</span>&nbsp;</blockquote><blockquote class="tr_bq"><span style="font-family: Courier New, Courier, monospace;">for i in $inputbed.*; do sort -k2,2n $i &gt; $i.s &amp; done<br /># when it's done<br />sort -m -k1,1 -k2,2n $inputbed.*s &gt; $inputbed.sorted</span><br />The trick is to split large file into small ones (in this case, one per chromosome), then sort individual one in a&nbsp;parallel&nbsp;way. Finally we merge them by "sort -m" (Note: sort-merge is not just to concatenate files, but rather sort of sorting-and-merging)</blockquote><span style="background-color: #3d85c6;">Solution #2:&nbsp;</span><br /><blockquote class="tr_bq">A parallel solution is to use <a href="http://www.gnu.org/software/coreutils/manual/coreutils.html#sort-invocation">sort</a> from <a href="http://www.gnu.org/software/coreutils/">coreultils</a>: <span style="font-family: Courier New, Courier, monospace;">sort --parallel=N</span>. See my post here:&nbsp;http://www.biostars.org/p/66927/<br /><span style="font-family: Courier New, Courier, monospace;">LC_ALL=C sort --parallel=24 --buffer-size=2G -k1,1 -k2,2n allmap.bed &gt; allmap.sorted.bed</span></blockquote><span style="background-color: #3d85c6;">Solution #3:</span><br /><blockquote class="tr_bq">Use the sort-bed tool from <a href="https://code.google.com/p/bedops/wiki/performance#Independent_evaluations">BEDOPS</a><span style="font-family: Courier New, Courier, monospace;">sort-bed --max-mem 5G input.bed &gt; sorted.bed</span></blockquote>