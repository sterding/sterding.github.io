---
layout: post
title: How Tophat call junctions from deletions?
date: '2012-08-22T22:49:00.001-04:00'
author: Xianjun Dong
tags:
- Tophat
modified_time: '2012-08-23T15:41:15.430-04:00'
blogger_id: tag:blogger.com,1999:blog-12445049.post-4162962758458082240
blogger_orig_url: http://onetipperday.blogspot.com/2012/08/how-tophat-call-junctions-from-deletions.html
---

We noticed that in the output SAM file of Tophat, there are two kinds of CIGAR line indicating the same type of alignment - deletion:<br /><br />xxxxMxxxxDxxxxM &nbsp;and xxxxMxxxxNxxxxM<br /><br />Here is what I parsed from the source code of Tophat<br /><br />&nbsp;-------------- long_spanning_reads.cpp --------------<br /><br />&nbsp; &nbsp; &nbsp; /*<br />&nbsp; &nbsp; &nbsp; &nbsp;* FIXME, currently just differentiating between a deletion and a<br />&nbsp; &nbsp; &nbsp; &nbsp;* reference skip based on length. However, would probably be better<br />&nbsp; &nbsp; &nbsp; &nbsp;* to denote the difference explicitly, this would allow the user<br />&nbsp; &nbsp; &nbsp; &nbsp;* to supply their own (very large) deletions<br />&nbsp; &nbsp; &nbsp; &nbsp;*/<br />&nbsp; &nbsp; &nbsp; if ((lb-&gt;right - lb-&gt;left - 1) &lt;= max_deletion_length)<br />&nbsp; &nbsp; &nbsp; &nbsp; {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; new_cigar.push_back(CigarOp(<b>DEL</b>, lb-&gt;right - lb-&gt;left - 1));<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; antisense_closure = prev_hit-&gt;is_spliced() ? prev_hit-&gt;antisense_splice() : curr_hit-&gt;antisense_splice();<br />&nbsp; &nbsp; &nbsp; &nbsp; }<br />&nbsp; &nbsp; &nbsp; else<br />&nbsp; &nbsp; &nbsp; &nbsp; {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; new_cigar.push_back(CigarOp(<b>REF_SKIP</b>, lb-&gt;right - lb-&gt;left - 1));<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; antisense_closure = lb-&gt;antisense;<br />&nbsp; &nbsp; &nbsp; &nbsp; }<br /><div><br /></div><div>As the author commented, this is still to fix.<br /><br />From the code above, it seems that max_deletion_length is the one to control the DEL from REF_SKIP. But it does not change the output if I tune the value of&nbsp;<span style="background-color: white; color: #555555; font-family: 'Courier New', Courier, monospace; font-size: 13px; line-height: 20.46666717529297px; white-space: nowrap;">--max-deletion-length</span> in Tophat.<br /><br />I also tried to confirm this by compiling the code myself, but have an error from making at the moment ("<b>tophat_reports.cpp:105: error: ‘boost::random::mt19937’ has not been declared"</b>). mt19937 is found in ~/include/boost/tr1/random.hpp, but even I include &lt;boost/tr1/random.hpp&gt; in tophat_reports.cpp, it still doesn't work. Don;t know why...<br /><br /><br /></div>