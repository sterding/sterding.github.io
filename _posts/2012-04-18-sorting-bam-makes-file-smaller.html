---
layout: post
title: sorting BAM makes the file smaller
date: '2012-04-18T13:30:00.001-04:00'
author: Xianjun Dong
tags:
- sort
- next-generation sequencing
- BAM
- samtools
modified_time: '2012-05-09T10:17:41.138-04:00'
blogger_id: tag:blogger.com,1999:blog-12445049.post-4732640626188430625
blogger_orig_url: http://onetipperday.blogspot.com/2012/04/sorting-bam-makes-file-smaller.html
---

Yes, it's not just me to notice this change. See here: http://seqanswers.com/forums/archive/index.php/t-13652.html<br /><br />As Heng said, "BAM is compressed. Sorting helps to give a better compression ratio because similar sequences are grouped together."... So it's not because of the removal of the unmapped reads (which are put at the end). <br /><br />The tips is - always sort the output BAM after converting a SAM, e.g.<br /><div><br /></div><div>samtools view -Sbu in.sam | samtools sort - in.sorted</div><div>mv in.sorted.bam in.bam</div><div><br /></div><div>Sorted BAM is smaller and better for searching.&nbsp;</div><div><br /></div><div>---------------------------</div><div>Other tips are:</div><div><br /></div><div>1. SAM-&gt;BAM does not require a sorted header, nor a header.&nbsp;</div><div>If there is header, samtools view -Sb in.sam &gt; in.bam</div><div>if there is no header, samtools view -Sbt genome.fa.fai in.sam &gt; in.bam</div><div>But the in.bam will not follow the order in the sequence dictionary (genome.fa.fai) unless you sort it by samtools sort.&nbsp;</div><div><br /></div><div>2. If input BAM, cufflinks require a proper header for the BAM file, esp. the line of&nbsp;</div><div><br /></div><div>@HD<span class="Apple-tab-span" style="white-space: pre;"> </span>VN:1.0<span class="Apple-tab-span" style="white-space: pre;"> </span>SO:coordinate</div><div><br /></div><div>Without the line, even if your BAM (or SAM) is sorted, but cufflinks cannot tell it by the file, only if you provide the info through the @HD line. So, I guess&nbsp;</div><div><br /></div><div>@HD<span class="Apple-tab-span" style="white-space: pre;"> </span>VN:1.0<span class="Apple-tab-span" style="white-space: pre;"> </span>SO:unsorted&nbsp;</div><div><br /></div><div>won't work.&nbsp;</div><div><br /></div>