---
layout: post
title: Using ANOVA to get correlation between categorical and continuous variables
date: '2015-08-16T17:08:00.001-04:00'
author: Xianjun Dong
tags:
- correlation
- statistics
- ANOVA
- regression
modified_time: '2015-08-16T17:54:30.546-04:00'
blogger_id: tag:blogger.com,1999:blog-12445049.post-1713078940569278204
blogger_orig_url: http://onetipperday.blogspot.com/2015/08/using-anova-to-get-correlation-between.html
---

How to calculate the correlation between categorical variables and continuous variables?<br /><br />This is the question I was facing when attempting to check the correlation of PEER inferred factors vs. known covariates (e.g. batch).<br /><br />One solution I found is, I can use ANOVA to calculate the R-square between categorical input and continuous output.<br /><br />Here is my R code snip:<br /><br /><span style="font-family: Courier New, Courier, monospace;"><b>## correlation of inferred factors vs. known factors</b></span><br /><span style="font-family: Courier New, Courier, monospace;"><b># name PEER factors</b></span><br /><span style="font-family: Courier New, Courier, monospace;"><b>colnames(factors)=paste0("PEER_top_factor_",1:bestK)</b></span><br /><span style="font-family: Courier New, Courier, monospace;"><b># continuous known covariates:</b></span><br /><span style="font-family: Courier New, Courier, monospace;"><b>covs2=subset(covs, select=c(RIN, PMI, Age));</b></span><br /><span style="font-family: Courier New, Courier, monospace;"><b># re-generate batch categorical variable from individual binary indicators (required by PEER)</b></span><br /><span style="font-family: Courier New, Courier, monospace;"><b>covs2=cbind(covs2, batch=paste0("batch",apply(covs[,1:6],1,which.max)))</b></span><br /><span style="font-family: Courier New, Courier, monospace;"><b>covs2=cbind(covs2, Sex=ifelse(covs$Sex,"M","F"), readLength=ifelse(covs$readsLength_75nt, "75nt", "50nt"))</b></span><br /><span style="font-family: Courier New, Courier, monospace;"><b><br /></b></span><span style="font-family: Courier New, Courier, monospace;"><b>library("plyr")</b></span><br /><span style="font-family: Courier New, Courier, monospace;"><b># ref: http://stackoverflow.com/a/11421267</b></span><br /><span style="font-family: Courier New, Courier, monospace;"><b>xvars=covs2; yvars=as.data.frame(factors);</b></span><br /><span style="font-family: Courier New, Courier, monospace;"><b>r2 &lt;- laply(xvars, function(x) {</b></span><br /><span style="font-family: Courier New, Courier, monospace;"><b>&nbsp; laply(yvars, function(y) {</b></span><br /><span style="font-family: Courier New, Courier, monospace;"><b>&nbsp; &nbsp; <span style="background-color: yellow;">summary.lm(aov(y~x))$r.squared</span></b></span><br /><span style="font-family: Courier New, Courier, monospace;"><b>&nbsp; })</b></span><br /><span style="font-family: Courier New, Courier, monospace;"><b>})</b></span><br /><span style="font-family: Courier New, Courier, monospace;"><b>rownames(r2) &lt;- colnames(xvars)</b></span><br /><span style="font-family: Courier New, Courier, monospace;"><b>colnames(r2) &lt;- colnames(yvars)</b></span><br /><span style="font-family: Courier New, Courier, monospace;"><b><br /></b></span><span style="font-family: Courier New, Courier, monospace;"><b>pvalue &lt;- laply(xvars, function(x) {</b></span><br /><span style="font-family: Courier New, Courier, monospace;"><b>&nbsp; laply(yvars, function(y) {</b></span><br /><span style="font-family: Courier New, Courier, monospace;"><b>&nbsp; &nbsp; <span style="background-color: yellow;">anova(lm(y~x))$`Pr(&gt;F)`[1]</span></b></span><br /><span style="font-family: Courier New, Courier, monospace;"><b>&nbsp; })</b></span><br /><span style="font-family: Courier New, Courier, monospace;"><b>})</b></span><br /><span style="font-family: Courier New, Courier, monospace;"><b>rownames(pvalue) &lt;- colnames(xvars)</b></span><br /><span style="font-family: Courier New, Courier, monospace;"><b>colnames(pvalue) &lt;- colnames(yvars)</b></span><br /><div><span style="font-family: Courier New, Courier, monospace;"><b><br /></b></span></div><div><div><span style="font-family: Courier New, Courier, monospace;"><b>require(pheatmap);</b></span></div><div><span style="font-family: Courier New, Courier, monospace;"><b>pheatmap(-log10(t(pvalue)),color= colorRampPalette(c("white", "blue"))(10), cluster_row =F, cluster_col=F, display_numbers=as.matrix(t(round(r2,2))), filename="peer.factor.correlation.pdf")</b></span></div></div><div><br /></div><div>I highlighted the core part in yellow color. As it shows, we can use <span style="font-family: Courier New, Courier, monospace;">aov()</span> function in R to run ANOVA. Its result can be summarized with <span style="font-family: Courier New, Courier, monospace;">summary.lm()</span> function, which show output like:</div><div><br /></div><div><pre><span style="font-family: Courier New, Courier, monospace;"><b>&gt; summary.lm(results)<br /><br />Call:<br />aov(formula = weight ~ group)<br /><br />Residuals:<br />    Min      1Q  Median      3Q     Max <br />-1.0710 -0.4180 -0.0060  0.2627  1.3690 <br /><br />Coefficients:<br />            Estimate Std. Error t value Pr(&gt;|t|)<br />(Intercept)   5.0320     0.1971  25.527   &lt;2e-16<br />grouptrt1    -0.3710     0.2788  -1.331   0.1944<br />grouptrt2     0.4940     0.2788   1.772   0.0877<br /><br />Residual standard error: 0.6234 on 27 degrees of freedom<br /><span style="color: red;">Multiple R-squared: 0.2641</span>,     Adjusted R-squared: 0.2096 <br />F-statistic: 4.846 on 2 and 27 DF,  <span style="color: red;">p-value: 0.01591</span></b></span></pre></div><div><br /></div>R^2 and p-value are shown at the end of output.<br /><br />Note: the <span style="font-family: Courier New, Courier, monospace;">summary.lm()</span> object doesn't contain value of p-value directly. But we can compute p-value in command like:<br /><br /><pre><span style="font-family: Courier New, Courier, monospace;"><b>&gt; F=summary.lm(results)$fstatistic</b></span></pre><pre><span style="font-family: Courier New, Courier, monospace;"><b>&gt; F=as.numeric(F)</b></span></pre><pre><span style="font-family: Courier New, Courier, monospace;"><b>&gt; pf(F[1],F[2],F[3])</b></span></pre><br />Below table is a nice summary the methods applicable to corresponding data type. <br /><br /><table border="1" style="width: 80%px;"><tbody><tr><td width="35%"><strong>PREDICTOR VARIABLE (S)</strong></td><td colspan="2" width="65%"><div align="center"><strong>OUTCOME VARIABLE</strong></div></td></tr><tr><td width="35%"></td><td width="26%"><strong>Categorical</strong></td><td width="39%"><strong>Continuous</strong></td></tr><tr><td width="35%"><strong>Categorical</strong></td><td width="26%"><span style="color: red;">Chi Square</span>, Log linear, Logistic</td><td width="39%">t-test,&nbsp;<span style="color: red;">ANOVA</span>&nbsp;<span style="color: red;">(Analysis of Varirance)</span>,&nbsp;<span style="color: red;">Linear regression</span></td></tr><tr><td width="35%"><strong>Continuous</strong></td><td width="26%">Logistic regression</td><td width="39%"><span style="color: red;">Linear regression</span>,&nbsp;&nbsp;<span style="color: red;">Pearson correlation</span></td></tr><tr><td width="35%"><strong>Mixture of Categorical and Continuous</strong></td><td width="26%">Logistic regression</td><td width="39%"><span style="color: red;">Linear regression</span>,&nbsp;<span style="color: black;">Analysis of Covariance</span></td></tr></tbody></table>Ref:http://www.tulane.edu/~panda2/Analysis2/sidebar/stats.htm<br /><br />Next thing I need to refresh my mind is how different in calculating the correlation using cor() and the above ANOVA method above.<br /><br />I know the correlation coefficient r can be inferred from the coefficient and sd of two variables. For example, we know sd(x) and sd(y), then when regressing y~x, we got regression line e.g. y=b0 + b1x. Then we can calculate r as <br /><br />r = b1 * SDx / SDy<br /><br />When x and y are in standard normal distribution, e.g. u=0, sd=1, then r=b1. <br />https://people.richland.edu/james/ictcm/2004/weight.html<br />http://ww2.coastal.edu/kingw/statistics/R-tutorials/oneway.html