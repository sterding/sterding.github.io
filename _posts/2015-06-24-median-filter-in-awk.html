---
layout: post
title: median filter in AWK
date: '2015-06-24T15:47:00.001-04:00'
author: Xianjun Dong
tags:
- median
- filter
- awk
modified_time: '2015-06-24T17:12:31.839-04:00'
thumbnail: http://1.bp.blogspot.com/--O0Fm6ggZqY/VYsc_mBsqnI/AAAAAAAAA38/mNTJ2kJRSyU/s72-c/content_08.png
blogger_id: tag:blogger.com,1999:blog-12445049.post-7289708478664121449
blogger_orig_url: http://onetipperday.blogspot.com/2015/06/median-filter-in-awk.html
---

<div style="text-align: center;"><img border="0" src="http://1.bp.blogspot.com/--O0Fm6ggZqY/VYsc_mBsqnI/AAAAAAAAA38/mNTJ2kJRSyU/s1600/content_08.png" /></div>Here is what <a href="https://en.wikipedia.org/wiki/Median_filter">median filter</a> does from wikipedia:<br /><blockquote class="tr_bq"><span style="background-color: #eeeeee;">To demonstrate, using a window size of three with one entry immediately preceding and following each entry, a median filter will be applied to the following simple 1D signal:<br />x = [2 80 6 3]<br />So, the median filtered output signal y will be:<br />y[1] = Median[2 2 80] = 2<br />y[2] = Median[2 80 6] = Median[2 6 80] = 6<br />y[3] = Median[80 6 3] = Median[3 6 80] = 6<br />y[4] = Median[6 3 3] = Median[3 3 6] = 3<br />i.e. y = [2 6 6 3].<br />Note that, in the example above, because there is no entry preceding the first value, the first value is repeated, as with the last value, to obtain enough entries to fill the window. This is one way of handling missing window entries at the boundaries of the signal.</span></blockquote><div><div style="background-color: white; color: #252525; font-family: sans-serif; font-size: 14px; line-height: 22.3999996185303px; margin-bottom: 0.5em; margin-top: 0.5em;">Here is my awk code to implement this:</div><div style="background-color: white; margin-bottom: 0.5em; margin-top: 0.5em;"><span style="color: #252525; font-family: Courier New, Courier, monospace;"><span style="font-size: 14px; line-height: 22.3999996185303px;">#!/bin/awk -f</span></span><br /><span style="color: #252525; font-family: Courier New, Courier, monospace;"><span style="font-size: 14px; line-height: 22.3999996185303px;"># awk script to filter noise by sliding a window and taking mean or median per window</span></span><br /><span style="color: #252525; font-family: Courier New, Courier, monospace;"><span style="font-size: 14px; line-height: 22.3999996185303px;"># Authos: Xianjun Dong</span></span><br /><span style="color: #252525; font-family: Courier New, Courier, monospace;"><span style="font-size: 14px; line-height: 22.3999996185303px;"># Date: 2015-06-23</span></span><br /><span style="color: #252525; font-family: Courier New, Courier, monospace;"><span style="font-size: 14px; line-height: 22.3999996185303px;"># Usage: _filter.awk values.txt</span></span><br /><span style="color: #252525; font-family: Courier New, Courier, monospace;"><span style="font-size: 14px; line-height: 22.3999996185303px;"># bigWigSummary input.bigwig chr10 101130293 101131543 104 | _filter.awk -vW=5 -vtype=median</span></span><br /><span style="color: #252525; font-family: Courier New, Courier, monospace;"><span style="font-size: 14px; line-height: 22.3999996185303px;">BEGIN{</span></span><br /><span style="color: #252525; font-family: Courier New, Courier, monospace;"><span style="font-size: 14px; line-height: 22.3999996185303px;">&nbsp; if(W=="") W=5;&nbsp;</span></span><br /><span style="color: #252525; font-family: Courier New, Courier, monospace;"><span style="font-size: 14px; line-height: 22.3999996185303px;">&nbsp; if(type=="") type="median";</span></span><br /><span style="color: #252525; font-family: Courier New, Courier, monospace;"><span style="font-size: 14px; line-height: 22.3999996185303px;">&nbsp; half=(W-1)/2;</span></span><br /><span style="color: #252525; font-family: Courier New, Courier, monospace;"><span style="font-size: 14px; line-height: 22.3999996185303px;">}&nbsp;</span></span><br /><span style="color: #252525; font-family: Courier New, Courier, monospace;"><span style="font-size: 14px; line-height: 22.3999996185303px;">{</span></span><br /><span style="color: #252525; font-family: Courier New, Courier, monospace;"><span style="font-size: 14px; line-height: 22.3999996185303px;">&nbsp; for(i=1;i&lt;=NF;i++) {</span></span><br /><span style="color: #252525; font-family: Courier New, Courier, monospace;"><span style="font-size: 14px; line-height: 22.3999996185303px;">&nbsp; &nbsp; array[half+1]=$i</span></span><br /><span style="color: #252525; font-family: Courier New, Courier, monospace;"><span style="font-size: 14px; line-height: 22.3999996185303px;">&nbsp; &nbsp; for(k=1;k&lt;=half;k++){</span></span><br /><span style="color: #252525; font-family: Courier New, Courier, monospace;"><span style="font-size: 14px; line-height: 22.3999996185303px;">&nbsp; &nbsp; &nbsp; array[half+1-k]=(i&lt;=k)?$1:$(i-k);</span></span><br /><span style="color: #252525; font-family: Courier New, Courier, monospace;"><span style="font-size: 14px; line-height: 22.3999996185303px;">&nbsp; &nbsp; &nbsp; array[half+1+k]=((i+k)&gt;NF)?$NF:$(i+k);</span></span><br /><span style="color: #252525; font-family: Courier New, Courier, monospace;"><span style="font-size: 14px; line-height: 22.3999996185303px;">&nbsp; &nbsp; }</span></span><br /><span style="color: #252525; font-family: Courier New, Courier, monospace;"><span style="font-size: 14px; line-height: 22.3999996185303px;">&nbsp; &nbsp; if(type=="median") {asort(array); x=array[half+1];}</span></span><br /><span style="color: #252525; font-family: Courier New, Courier, monospace;"><span style="font-size: 14px; line-height: 22.3999996185303px;">&nbsp; &nbsp; if(type=="mean") {x=0; for(j=1;j&lt;=W;j++) x+=array[j]; x=x/W;}</span></span><br /><span style="color: #252525; font-family: Courier New, Courier, monospace;"><span style="font-size: 14px; line-height: 22.3999996185303px;">&nbsp; &nbsp; printf("%s\t", x);</span></span><br /><span style="color: #252525; font-family: Courier New, Courier, monospace;"><span style="font-size: 14px; line-height: 22.3999996185303px;">&nbsp; }</span></span><br /><span style="color: #252525; font-family: Courier New, Courier, monospace;"><span style="font-size: 14px; line-height: 22.3999996185303px;">&nbsp; print "";</span></span><br /><span style="color: #252525; font-family: Courier New, Courier, monospace;"><span style="font-size: 14px; line-height: 22.3999996185303px;">}</span></span></div></div>