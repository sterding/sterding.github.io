---
layout: post
title: a bigWigSummary bug
date: '2014-09-03T15:54:00.002-04:00'
author: Xianjun Dong
tags:
- UCSC
- bug report
- bigWigSummary
modified_time: '2014-09-17T03:15:38.165-04:00'
blogger_id: tag:blogger.com,1999:blog-12445049.post-7574415838158356917
blogger_orig_url: http://onetipperday.blogspot.com/2014/09/a-bigwigsummary-bug.html
---

Write down a bigwigsummary bug I found today. It's found when I attempted to get the max value in a region using -type=max and dataPoints=1:<br /><div class="p2"><br /></div><div class="p1"><span style="font-family: Courier New, Courier, monospace;">$ bigWigSummary test.bw -type=max chr12 54070173 54072173 1</span></div><div class="p1"><span style="font-family: Courier New, Courier, monospace;">13.3672</span></div><div class="p1"><span style="font-family: Courier New, Courier, monospace;">$ bigWigSummary test.bw -type=max chr12 54070173 54072173 10</span></div><div class="p1"><span style="font-family: Courier New, Courier, monospace;">0.944904<span class="Apple-tab-span"> </span>1.02475<span class="Apple-tab-span"> </span>0.568405<span class="Apple-tab-span"> </span>0.741671<span class="Apple-tab-span"> </span>1.43119<span class="Apple-tab-span"> </span>1.08896<span class="Apple-tab-span"> </span>0.705965<span class="Apple-tab-span"> </span>0.542034<span class="Apple-tab-span"> </span>0.380971<span class="Apple-tab-span"> </span>0.591934</span></div><div class="p2"><br /></div><div class="p1">As you see, if I use dataPoints=1, the max value is 13.3672 and when I use dataPoints=10 the max value is 1.43119. So there must be something wrong, since the max value should not change no matter how many data points we check. Visualizing the bigwig in UCSC Genome Browser shows that 1.43119 is correct for this case. Interestingly, 13.3672 is indeed a peak summit, but not for this region, rather a region upstream. I donâ€™t know why bigWigSummary take the summit from region outside. This only happened when dataPoints=1.&nbsp;</div><div class="p2"><br /></div><div class="p1">I put the data below. You can download to test:</div><br /><div class="p3"><span class="s1"><a href="https://www.dropbox.com/sh/q963gxj9e1kj8ly/AAAG-LqCT_WQi6dgMm0lhoDIa?dl=0">https://www.dropbox.com/sh/q963gxj9e1kj8ly/AAAG-LqCT_WQi6dgMm0lhoDIa?dl=0</a></span></div><div class="p3"><br /></div><div class="p3">People reported similar error for bigwigSummary, for example</div><div class="p3"><br /><a href="https://groups.google.com/a/soe.ucsc.edu/forum/#!topic/genome/-FnP9CqH-fA" target="_blank">bigWigSummary outputs different values as bigWigAverageOverBed</a>: UCSC team explained&nbsp;"The reason for this is that the summary levels have some rounding error and some border conditions when extracting data over relatively small regions." They suggested to use bigWigAverageOverBed if you want the highest level of accuracy. But bigWigAverageOverBed won't output the max and also it's nothing with high or low accuracy, but rather a bug.&nbsp;</div><div class="p3"><br /></div><div class="p3">Tao Liu also reported <a href="https://plus.google.com/110277535354382810645/posts/KPkorLEMhtv" target="_blank">another bug for bigwig when it's converted from wig in compressed manner</a> (by default), and suggested to fix it by using -unc when converting wig to bigwig. I've tried to use -unc when converting from bedGraph to bigwig, the bug is still there.&nbsp;</div><div class="p3"><br /></div><div class="p3">Still looking for workout, and also report to UCSC:</div><div class="p3">https://groups.google.com/a/soe.ucsc.edu/forum/#!topic/genome/pWjcov-xQyQ<br /><br /><b>Update</b>: One workout I found is, to use intersectBed and groupBy in bedtools on bedGraph file (rather than bigwig). Here is pseudocode:<br /><br /><span style="font-family: Courier New, Courier, monospace;">intersectBed -a regions.bed -b signal.bedGraph -wo -sorted | groupBy -g 1,2,3 -c 7 -o max &gt; regions.maxSignal.bed</span><br /><br /><b>Update2</b>: &nbsp;use the -minMax option from the latest version of&nbsp;bigWigAverageOverBed (from&nbsp;<span style="background-color: white; color: #222222; font-family: Arial, Helvetica, sans-serif; font-size: 13px;">v304</span>). See reply from UCSC group:<br /><blockquote><span style="background-color: #cccccc;">Thank you for contacting us. One of our engineers was able to reproduce this and says the bigWigSummary program uses the bigWig summary levels, which are lower resolution versions of the data, so when you ask for a single value in a particular range, the range that is used may include bases that are before and after the range.</span><span style="background-color: #cccccc;"><br /></span><span style="background-color: #cccccc;">If you want only the values exactly within the range, you can use (the latest version from&nbsp;<span style="color: #222222; font-family: Arial, Helvetica, sans-serif; font-size: 13px;">v304</span>) bigWigAverageOverBed like so:</span><span style="background-color: #cccccc;"><br /></span><span style="background-color: #cccccc;"><span style="font-family: Courier New, Courier, monospace;">echo "chr12 54070173 54072173 one" | bigWigAverageOverBed myTest.bw stdin stdout -minMax | cut -f 8</span></span></blockquote></div>