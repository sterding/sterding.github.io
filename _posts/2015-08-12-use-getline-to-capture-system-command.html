---
layout: post
title: 'use getline to capture system command output in awk '
date: '2015-08-12T15:31:00.002-04:00'
author: Xianjun Dong
tags:
- awk
- awk.system
- getline
- unix
modified_time: '2015-08-12T15:31:24.400-04:00'
blogger_id: tag:blogger.com,1999:blog-12445049.post-2058869104315105171
blogger_orig_url: http://onetipperday.blogspot.com/2015/08/use-getline-to-capture-system-command.html
---

I just learnt this today: awk also has its pipe (|) and getline, just like unix. If I want to call a system command in awk and capture its output (Note: system() won't work as it only return the exit status), I can use pipe the output to getline.&nbsp;<div><br /></div><div>For example,<br /><div><br /></div><div><span style="font-family: Courier New, Courier, monospace;">$cat &gt; test.txt</span></div><div><span style="font-family: Courier New, Courier, monospace;">aa bb cc</span></div><div><span style="font-family: Courier New, Courier, monospace;">11 22 33</span></div><div><span style="font-family: Courier New, Courier, monospace;">44 55 cc</span><br /><br />       <div class="p1"><span class="s1"><span style="font-family: Courier New, Courier, monospace;">$awk 'BEGIN{cmd="grep cc test.txt | sort -k1,1 | head -n1 | cut -f2 -d\" \""; cmd | getline a; print a}'</span></span></div><div><span style="font-family: Courier New, Courier, monospace;">55</span></div><div><br /></div>or&nbsp;</div><div><br /></div><div><span style="font-family: Courier New, Courier, monospace;">$awk 'BEGIN{cmd="grep cc test.txt | sort -k1,1 | head -n1 | cut -f2 -d\" \""; system(cmd);}'</span></div><div><span style="font-family: Courier New, Courier, monospace;">55</span></div><div><br /></div><div>Note that if only use cmd, it won't print out anything, because cmd itself won't switch to console (unlike system).&nbsp;</div><div><br /></div><div><div><span style="font-family: Courier New, Courier, monospace;">$awk 'BEGIN{cmd="grep cc test.txt | sort -k1,1 | head -n1 | cut -f2 -d\" \""; cmd;}'</span></div></div><div><br /></div><div>If you want to output the multiple lines and process them in awk, you can do<br /><br /><div><div><span style="font-family: Courier New, Courier, monospace;">$awk 'BEGIN{cmd="grep cc test.txt | sort -k1,1 | cut -f2 -d\" \""; while( (cmd | getline a) &gt;0) print a;}'</span></div><div>       <div class="p1"><span class="s1"><span style="font-family: Courier New, Courier, monospace;">55</span></span></div><div class="p1"><span class="s1"><span style="font-family: Courier New, Courier, monospace;">bb</span></span></div></div><br />Reference: <a href="http://stackoverflow.com/questions/1960895/awk-assigning-system-commands-output-to-variable">http://stackoverflow.com/questions/1960895/awk-assigning-system-commands-output-to-variable</a></div></div></div>